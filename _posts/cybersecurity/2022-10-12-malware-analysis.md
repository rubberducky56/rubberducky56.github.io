---
layout: post
title: "Malware Analysis At A Glance"
author: "Mouse"
categories: cybersecurity
tags: [cybersecurity, programming, malware, reverse-engineering]
image: malware_analysis.png
permalink: /cybersecurity/malware-analysis-glance
---

### What is Malware?

__Malware__, or malicious software, is software designed to cause harm to a system or network. It is common for malware to have mechanisms built in to spread itself throughout a system, remain undetectable, damage data, and render a computer unusable.

One famous example of malware is __Stuxnet__. In January 2010, a routine inspection of the Natanz Uranium Enrichment Plant in Iran was carried out by the International Atomic Energy Agency. They found that many centrifuges were failing, but no cause was specified. Later in 2010, a number of computer systems in the plant were crashing and rebooting. When technicians analysed the computer for __IoCs__, or __indicators of compromise__, they found numerous malicious files installed. Those technicians had just discovered one of the most infamous pieces of malware ever cooked up - Stuxnet.

Stuxnet spread itself through Windows PCs and USB sticks until it found its way into the Natanz plant. When critical __SCADA__ (Supervisory Control and Data Acquisition) systems, such as nuclear gas centrifuges, were infected, the malware caused them to malfunction. The Natanz centrifuges would essentially tear themselves apart.

Stuxnet was an extremely sophisticated, targeted attack which severely crippled Iran’s nuclear weapons program. It is speculated that Stuxnet was built as a cyber weapon as a collaboration between US and Israeli intelligence agencies, but neither have since claimed responsibility. Stuxnet was the first demonstration of malware being used to cause significant physical damage, and bring a country’s nuclear program to its knees.

This article is an introduction to malware, and will discuss some basic malware analysis techniques. Malware analysis is a huge area, so I will only be scratching the surface. This article is loosely based off the [TryHackMe malware module](https://tryhackme.com/module/malware-analysis).

### Types of Malware

Malware campaigns generally come in two flavours:
1. __Targeted campaigns__ - created for a specific purpose for a specific target
>The Stuxnet malware campaign was targeted - it was targeting Iranian nuclear facilities

2. __Mass campaigns__ - the aim is to infect as many devices as possible, and are usually run by __APT__ groups, or __Advanced Persistent Threat__ groups.
>In April 2022, Bitdefender detailed a mass malware campaign using _RedLine Stealer_ - a data harvesting piece of malware that can steal passwords, usernames and credit card data on Windows PCs. RedLine Stealer is often sold on underground forums as _malware-as-a-service_. This is when novices can buy malware off the shelf and execute their own malware campaigns. Bitdefender’s whitepaper can be downloaded from [here]https://www.bitdefender.com/blog/labs/redline-stealer-resurfaces-in-fresh-rig-exploit-kit-campaign/.

Malware can come in all shapes and sizes, and some common malware types are listed below. Note that some definitions have no consensus - I will be using the definitions coined by Fortinet.

* __Viruses__ - malware which can propagate through a system, but requires human intervention
  * __File viruses__ - These infect files on a system, often executables, and can infect other files when opened
  * __Macro viruses__ - Microsoft Office products allow users to write small programs to automate repetitive tasks, called macros. Macro viruses infect Microsoft Office files, and propagate once the file is opened
  * __Polymorphic viruses__ - Viruses that can change their form to evade detection
* __Trojans__ - Malware that hides in legitimate files, named after the famous Trojan Horse from Greek mythology
* __Worms__ - Malware that is similar to viruses, but does not require human intervention to propagate - they spread themselves through a system
*__Spam__ - Malware that is stored inside email attachments or links, usually tricking a user to click a link or download a program
* __Ransomware__ - Malware that encrypts data on a system, and kindly requests users to pay a ransom to get their data back, usually in the form of cryptocurrencies.
* __Rootkits__ - Malware that functions as a Swiss army knife - they embed themselves deep into a system, often onto the kernel itself, and allow threat actors complete control over a system
* __Adware__ - One of the most common types of malware infection, these will cause unwanted advertisements to pop up all over a computer system
* __Spyware__ - Malware that quietly infects a system and sends personal data back to threat actors. This category includes keyloggers, which record all keystrokes typed by a user and sends these back to the threat actor.

### Malware Attack Chain

When malware infects a system it will usually follow a similar pattern, often leaving a trail of crumbs for malware analysts to follow. The steps most malware will go through are:

* __Delivery__ - The method by which the malware gains initial access to a system
> For example, USB sticks (like Stuxnet) and email attachments from phishing emails

* __Execution__ - The main part of malware classification, this is what the malware actually does to a system
>For example, ransomware will encrypt files and spyware will record and transmit data such as keystrokes.

* __Persistence__ - Usually malware will want to stay in the target system without being detected for further attack.
>Malware can often be found hiding in parts of a system like the registry and startup programs.

* __Propagation__ - The method by which malware will spread to other avaliable devices
> The BlackBasta Ransomware can spread through local Windows machines by connecting to Active Directory, scanning for other computers on a local network, copy the malware onto them, then run them remotely with the [Component Object Model (COM)](https://learn.microsoft.com/en-us/windows/win32/com/component-object-model--com--portal). Trend Micro have a [fascinating analysis](https://www.trendmicro.com/en_no/research/22/e/examining-the-black-basta-ransomwares-infection-routine.html) of the BlackBasta ransomware.

This whole attack chain will leave signatures behind, both host-based and network-based:
* __Host-based__ - the results of any execution or persistence, such as encrypted files and additional installed software
>For example, automated vulnerability scans and enumeration on a system often leave a very obvious trail, and can usually be considered an indicator of compromise

* __Network-based__ - this includes any networking communications made during delivery, execution and propagation, for example connecting to a C2 server, or ransomware contacting victims for cryptocurrency payments
>__C2 servers__, or command and control servers, are servers run by threat actors to send additional instructions to small persistent programs hidden in a system called __beacons__.
